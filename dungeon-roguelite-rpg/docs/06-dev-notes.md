# 개발 구현 노트

## 기술 스택
- **프레임워크**: Next.js 16.1.6 (App Router)
- **언어**: TypeScript
- **스타일링**: Tailwind CSS
- **상태관리**: React useState + localStorage
- **빌드 도구**: Turbopack

## 실행 방법
```bash
cd prototype
npm install
npm run dev
```
기본 포트: http://localhost:3000

## 프로젝트 구조
```
prototype/
├── public/
│   └── assets/
│       ├── characters/     # 10종 (영웅 6 + 적 4)
│       └── backgrounds/    # 2종 (캠프, 던전)
└── src/
    ├── app/
    │   ├── layout.tsx      # 루트 레이아웃 (한국어 설정)
    │   ├── page.tsx        # 메인 페이지 (화면 라우터)
    │   └── globals.css     # 글로벌 스타일
    ├── components/
    │   ├── ui/
    │   │   └── CharacterAvatar.tsx # 캐릭터 이미지+이모지 폴백
    │   └── game/
    │       ├── MainScreen.tsx        # 메인 화면 (모닥불 캠프)
    │       ├── BattleScreen.tsx      # 전투 화면 (4:4 자동전투)
    │       ├── SkillSelectScreen.tsx # 로그라이트 스킬 3택
    │       ├── RestEventScreen.tsx   # 쉼터 이벤트
    │       ├── HeroListScreen.tsx    # 영웅 목록
    │       ├── FormationScreen.tsx   # 파티 편성
    │       ├── GachaScreen.tsx       # 영웅 소환 (가챠)
    │       └── ResultScreen.tsx      # 런 결과
    ├── hooks/
    │   └── useGameState.ts          # 게임 상태 관리 훅
    └── lib/
        ├── types.ts                 # 타입 정의
        ├── constants.ts             # 게임 상수/데이터
        └── game/
            ├── battle-engine.ts     # 전투 엔진 (턴제 자동전투)
            ├── enemy-factory.ts     # 적 유닛 생성
            ├── gacha.ts             # 가챠 시스템
            └── game-state.ts        # 세이브 관리
```

## 구현 현황

### 코어 게임
- [x] SPD 기반 턴 순서 결정
- [x] 자동 스킬 선택 (궁극기 게이지 100 → 궁극기, 아니면 기본스킬)
- [x] 자동 타겟 선택 (앞줄 우선, HP 가장 낮은 적)
- [x] 데미지 계산 (ATK * 배율 * (1 - DEF/(DEF+100)))
- [x] 힐 계산 (ATK * 배율)
- [x] 버프/디버프 시스템 (ATK UP/DOWN, DEF UP/DOWN, 재생, 출혈, 기절, 도발)
- [x] 궁극기 게이지 (기본스킬 +30, 피격 +20)
- [x] 앞줄 DEF 보너스 (+10%)
- [x] 도발 타겟팅
- [x] 특수 타겟팅 (암살자/궁수: HP 가장 낮은 적)
- [x] 10스테이지 진행 (HP/게이지 유지)
- [x] 이벤트 스테이지 (쉼터: HP 회복 or 랜덤 스킬)
- [x] 로그라이트 스킬 18종 (8일반, 6희귀, 4전설)
- [x] 스킬 3택 시스템 (등급별 확률, 중복 불가)
- [x] 영웅 6종 (아이언클래드, 블레이드, 실바나, 이그니스, 루미나, 쉐도우)
- [x] 적 7종 + 보스 (고블린 병사/궁수, 해골 전사, 다크 메이지, 오크 버서커, 뱀파이어 로드, 던전 로드)
- [x] 스테이지별 난이도 스케일링
- [x] 전투 배속 (1x/2x 토글)
- [x] 50라운드 초과 시 강제 패배 (무한루프 방지)

### 메타 시스템
- [x] 재화 시스템 (골드, 소울스톤, 영혼파편)
- [x] 영웅 뽑기 - 단일 (소울스톤 300)
- [x] 영웅 뽑기 - 10연차 (소울스톤 2,700, 10% 할인, ★3 보장)
- [x] 중복 영웅 → 영혼파편 전환
- [x] 스테이지별 보상 (골드/소울스톤/EXP)
- [x] 챕터 클리어 보너스 (최초 1회: 골드 500 + 소울스톤 500)
- [x] 런 실패 보상 (스테이지 수 * 5 골드)
- [x] 편성 시스템 (전열/후열 2+2 배치)
- [x] localStorage 세이브/로드
- [x] 세이브 초기화

### UI/비주얼
- [x] 메인 화면 (모닥불 캠프, 파티 표시, 챕터 정보, 하단 네비)
- [x] 전투 화면 (4:4 유닛 배치, HP바, 궁극기 바, 버프 아이콘, 턴순서, 배틀로그)
- [x] 스킬 선택 화면 (3장 카드, 등급별 색상)
- [x] 쉼터 이벤트 화면 (HP 상태, 선택지 2개)
- [x] 영웅 목록 화면 (등급별 테두리, 스탯 표시, 미보유 그레이아웃)
- [x] 편성 화면 (전열/후열 슬롯, 영웅 선택)
- [x] 가챠 화면 (1회/10회 버튼, 확률 표시, 결과 팝업)
- [x] 결과 화면 (클리어/실패, 보상 표시)
- [x] 다크 판타지 컬러 팔레트 적용
- [x] 이모지 폴백 (이미지 로드 전/실패 시)

### 에셋 통합 (추가 완료)
- [x] CharacterAvatar 공통 컴포넌트 생성 (이미지 + 이모지 폴백)
- [x] 캠프파이어 배경 이미지 적용 (MainScreen)
- [x] 던전 전투 배경 이미지 적용 (BattleScreen)
- [x] 전투 유닛 이미지 (영웅 6종 + 적 4종 매핑)
- [x] 영웅 목록/편성/가챠 결과에 이미지 적용
- [x] 이미지 로드 실패 시 이모지 자동 폴백

### 미구현 (프로토타입 스코프 외)
- [ ] 영웅 레벨업 (EXP + 골드 소비 → 스탯 상승)
- [ ] 등급 승급
- [ ] 영혼파편 → 소울스톤 교환
- [ ] 전투 애니메이션 (공격/이동 모션)
- [ ] 사운드 효과
- [ ] 다중 챕터
- [ ] 장비 시스템
- [ ] PvP / 소셜

## 기술적 결정 사항

1. **전투 로직과 UI 분리**: battle-engine.ts는 순수 로직만 처리하고, UI(BattleScreen)는 상태를 받아 렌더링. setInterval로 라운드를 자동 진행.

2. **이모지 폴백 기본 적용**: 모든 유닛에 emoji 필드가 있어 이미지가 없어도 즉시 게임 플레이 가능.

3. **localStorage 저장**: 매 save 상태 변경 시 자동 저장. SSR 호환을 위해 window 체크.

4. **라운드 기반 자동전투**: 한 번에 전체 라운드를 실행하고 결과를 반환. 배속은 setInterval 간격만 조정.

## 알려진 제한 사항

1. 전투 애니메이션이 없어 유닛 이동/공격 모션 없이 상태만 업데이트됨
2. 영웅 레벨업 UI 미구현 (EXP는 누적되지만 소비 UI 없음)
3. 모바일 최적화 미완 (max-w-lg로 기본 제한만 적용)
4. 나노바나나 에셋은 생성형 AI로 만들어져 캐릭터 간 스타일 일관성이 완벽하지 않음
