# 메타 게임 디자인

## 성장 시스템

### 영웅 레벨
- 영웅은 전투 참여 시 경험치(EXP)를 획득하여 레벨업한다.
- **최대 레벨**: 20 (프로토타입 기준)
- **레벨업 효과**: 레벨당 기본 스탯(HP, ATK, DEF) +5%
- **필요 경험치 테이블**:

| 레벨 | 누적 EXP | 구간 EXP |
|------|---------|---------|
| 1→2 | 100 | 100 |
| 2→3 | 250 | 150 |
| 3→4 | 450 | 200 |
| 4→5 | 750 | 300 |
| 5→10 | 구간당 +100씩 증가 | 400~800 |
| 10→15 | 구간당 +200씩 증가 | 1000~1800 |
| 15→20 | 구간당 +300씩 증가 | 2100~3300 |

- **EXP 획득 경로**: 던전 전투 승리 시 편성된 4명 영웅이 균등 분배로 획득

### 영웅 등급 체계
- 5단계 등급: ★1(Common) / ★2(Uncommon) / ★3(Rare) / ★4(Epic) / ★5(Legendary)
- 등급별 기본 스탯 배율:

| 등급 | 스탯 배율 | 보유 스킬 수 | 컬러 코드 |
|------|----------|------------|----------|
| ★1 Common | x1.0 | 1 | #9E9E9E (회색) |
| ★2 Uncommon | x1.2 | 1 | #4CAF50 (초록) |
| ★3 Rare | x1.5 | 2 | #2196F3 (파랑) |
| ★4 Epic | x1.9 | 2 | #9C27B0 (보라) |
| ★5 Legendary | x2.5 | 3 | #FF9800 (주황) |

- **프로토타입 초기 지급 영웅**: ★2 영웅 2명 (전사 1, 힐러 1)
- **등급 승급**: 프로토타입에서는 미구현 (명시적 제외)

---

## 영웅 수집 시스템

### 가챠(뽑기) 구조
- **뽑기 종류**: 일반 소환 1종만 구현
- **단일 뽑기 비용**: 소울스톤 300개
- **10연차 비용**: 소울스톤 2,700개 (10% 할인)

### 확률 테이블

| 등급 | 단일 뽑기 확률 | 10연차 보정 |
|------|--------------|-----------|
| ★1 Common | 40% | 좌동 |
| ★2 Uncommon | 30% | 좌동 |
| ★3 Rare | 20% | 좌동 |
| ★4 Epic | 8% | 좌동 |
| ★5 Legendary | 2% | 좌동 |

### 10연차 보장 규칙
- 10연차 수행 시 **★3 이상 영웅 최소 1명 보장**
- 10회 결과 중 ★3 이상이 없으면 마지막 1회를 ★3으로 강제 교체
- (천장 시스템은 프로토타입에서 미구현)

### 중복 영웅 처리
- 이미 보유 중인 영웅이 뽑히면 **영혼 파편** 으로 자동 전환
- 전환량: ★1→10개, ★2→20개, ★3→50개, ★4→100개, ★5→200개
- 영혼 파편 200개 = 소울스톤 300개로 교환 가능 (뽑기 1회분)
- 프로토타입에서는 교환 UI만 존재, 복잡한 활용은 미구현

### 프로토타입 영웅 풀 (6종)

| 영웅명 | 등급 | 역할 | 포지션 | 획득 방법 |
|--------|------|------|--------|----------|
| 아이언클래드 (Ironclad) | ★2 | 탱커 | 전열 | 초기 지급 |
| 루미나 (Lumina) | ★2 | 힐러 | 후열 | 초기 지급 |
| 블레이드 (Blade) | ★3 | 전사/딜러 | 전열 | 가챠 |
| 실바나 (Silvana) | ★3 | 궁수/딜러 | 후열 | 가챠 |
| 이그니스 (Ignis) | ★4 | 마법사/딜러 | 후열 | 가챠 |
| 쉐도우 (Shadow) | ★5 | 암살자/딜러 | 전열 | 가챠 |

---

## 보상 구조

| 보상 종류 | 획득 경로 | 사용처 | 수량 기준 |
|----------|----------|--------|----------|
| 골드 | 전투 승리 (매 스테이지) | 영웅 레벨업 비용 | 스테이지당 50~150 |
| 소울스톤 | 스테이지 클리어, 챕터 클리어 보상 | 영웅 뽑기 | 스테이지당 30~80 |
| EXP | 전투 승리 시 | 영웅 레벨업 (자동 적용) | 스테이지당 20~60 |
| 영혼 파편 | 중복 영웅 뽑기 시 | 소울스톤 교환 | 뽑기 등급별 상이 |

### 스테이지별 보상 상세

| 스테이지 | 골드 | 소울스톤 | EXP (편성 영웅 총합) | 비고 |
|---------|------|---------|-------------------|------|
| 1~3 (일반) | 50 | 30 | 20 | 초반 구간 |
| 4 (이벤트: 쉼터) | 0 | 50 | 0 | HP 회복 + 보너스 소울스톤 |
| 5~7 (일반) | 80 | 50 | 40 | 중반 구간 |
| 8 (이벤트: 쉼터) | 0 | 50 | 0 | HP 회복 + 보너스 소울스톤 |
| 9 (일반) | 120 | 60 | 50 | 후반 구간 |
| 10 (보스) | 150 | 80 | 60 | 보스 스테이지 |
| **챕터 클리어 보너스** | **500** | **500** | **0** | **1챕터 최초 클리어 시 1회** |

### 1회 런 총 보상 (챕터 1 풀 클리어 시)
| 재화 | 총합 |
|------|------|
| 골드 | 500 (일반) + 500 (클리어 보너스) = **1,000** |
| 소울스톤 | 450 (일반) + 100 (쉼터) + 500 (클리어 보너스) = **1,050** |
| EXP | 영웅당 약 **58** (총 230 / 4명 분배) |

> **밸런스 의도**: 1회 런으로 단일 뽑기 3회분(900) 이상의 소울스톤 획득. 3~4회 런이면 10연차(2,700) 가능. 첫 클리어 보너스 포함 시 첫 런에서 바로 뽑기 3회 체험 가능.

---

## 진행 흐름

### 챕터 구조
- **프로토타입**: 챕터 1 "잊혀진 지하묘지" 만 구현
- 챕터 선택 UI에 좌우 화살표는 존재하나 챕터 2 이상은 "Coming Soon" 잠금 표시
- 1챕터 = 10스테이지 (일반 전투 8 + 이벤트 2)

### 스테이지 구성 맵

```
[1:일반] → [2:일반] → [3:일반] → [4:쉼터] → [5:일반] → [6:일반] → [7:일반] → [8:쉼터] → [9:일반] → [10:보스]
```

### 챕터 클리어 조건
- 10번째 스테이지(보스)를 승리로 클리어
- 중간에 전멸(파티 HP 전원 0) 시 런 실패 → 메인 화면으로 복귀
- **런 실패 시에도 진행한 스테이지까지의 보상은 유지** (로그라이트 친화적)

### 런 사이클 흐름
```
메인 화면 (모닥불 캠프)
    │
    ├─ [영웅 목록] 영웅 확인 / 레벨업
    ├─ [영웅 뽑기] 소울스톤으로 영웅 소환
    │
    └─ [던전 입장] 편성(4명) 선택 → 챕터 선택 → 전투 시작
            │
            ├─ 스테이지 클리어 → 로그라이트 스킬 선택(3택) → 다음 스테이지
            ├─ 이벤트 스테이지 → HP 회복 등 선택
            ├─ 전멸 → 현재까지 보상 정산 → 메인 복귀
            └─ 보스 클리어 → 챕터 클리어 보상 정산 → 메인 복귀
                    │
                    └─ 보상 재화로 뽑기/레벨업 → 재도전 (루프 완성)
```

---

## 재화 시스템

| 재화 | 아이콘 | 획득 경로 | 소비처 | 밸런스 기준 | 비고 |
|------|--------|----------|--------|-----------|------|
| **골드** | 금화 (동전 이모지 또는 아이콘) | 전투 승리, 챕터 클리어 | 영웅 레벨업 비용 | 1회 런 약 1,000 획득 | 기본 재화 |
| **소울스톤** | 보라색 보석 (크리스탈 아이콘) | 전투 승리, 챕터 클리어 보너스 | 영웅 뽑기 | 1회 런 약 1,050 획득 | 프리미엄 재화 (프로토타입에서는 무과금으로 획득) |
| **영혼 파편** | 파편 아이콘 | 중복 영웅 뽑기 시 | 소울스톤 교환 (200→300) | 가챠 부산물 | 보조 재화 |

### 골드 소비 밸런스 (영웅 레벨업 비용)

| 레벨업 구간 | 골드 비용 |
|-----------|----------|
| Lv.1→2 | 50 |
| Lv.2→3 | 80 |
| Lv.3→4 | 120 |
| Lv.4→5 | 170 |
| Lv.5→10 | 구간당 +60씩 증가 (230~530) |
| Lv.10→15 | 구간당 +100씩 증가 (630~1,030) |
| Lv.15→20 | 구간당 +150씩 증가 (1,180~1,780) |

> **밸런스 의도**: 1회 런(골드 1,000)으로 영웅 1명을 Lv.1→5까지 올릴 수 있음 (필요 골드: 420). 4명을 Lv.5까지 올리려면 약 2회 런 필요. 골드가 소울스톤보다 빠르게 소비되어 "뽑기만 하면 되는 것이 아니라 기존 영웅도 키워야 한다"는 선택 긴장감 생성.

### 재화 획득/소비 흐름도
```
[던전 전투 승리]
    ├─→ 골드 획득 ──→ 영웅 레벨업에 소비
    ├─→ 소울스톤 획득 ──→ 영웅 뽑기에 소비
    └─→ EXP 획득 ──→ 영웅 레벨업에 자동 적용

[영웅 뽑기]
    ├─→ 새 영웅 획득 ──→ 편성 강화
    └─→ 중복 영웅 ──→ 영혼 파편 ──→ 소울스톤 교환
```

---

## 리텐션 요소

프로토타입 범위 내에서 반복 플레이를 유도하는 장치:

### 1. 수집 욕구
- 영웅 목록 화면에서 미보유 영웅은 **실루엣(?)** 으로 표시
- "6종 중 N종 보유" 카운터로 수집 진행도 시각화
- ★4, ★5 영웅은 뽑기 확률이 낮으므로 여러 번 뽑기를 시도하게 유도

### 2. 로그라이트 리플레이
- 매 런마다 스킬 선택이 달라 다른 빌드 체험 가능
- "이번엔 다른 스킬 조합을 시도해볼까?" 동기
- 코어 시스템 영역이지만 메타 루프의 반복 동기와 직결

### 3. 편성 실험
- 새 영웅 획득 후 기존과 다른 편성 조합 시도
- 전열/후열 배치에 따른 전략 변화
- "방금 뽑은 ★4 모건을 넣어보면 어떨까?" 동기

### 4. 성장 진행감
- 레벨업으로 눈에 보이는 스탯 상승
- 이전에 어려웠던 스테이지를 더 쉽게 클리어하는 체감
- 보스 스테이지 클리어 시 "챕터 클리어!" 연출

### 5. 첫 클리어 보너스
- 챕터 1 최초 클리어 시 대량 보상 (골드 500 + 소울스톤 500)
- 재도전 시에는 기본 보상만 지급 (챕터 클리어 보너스 제외)
- 첫 클리어의 성취감과 함께 뽑기 자금 확보

---

## 코어 시스템 접점

### 메타 → 코어 (메타 시스템이 전투에 주는 영향)

| 메타 요소 | 코어 효과 | 설명 |
|----------|----------|------|
| 영웅 레벨 | 기본 스탯(HP/ATK/DEF) +5%/레벨 | Lv.10 영웅은 Lv.1 대비 스탯 45% 증가 |
| 영웅 등급 | 기본 스탯 배율 (x1.0~x2.5) | ★5 영웅은 ★1 대비 2.5배 스탯 |
| 영웅 보유 스킬 수 | 자동전투 시 사용 가능한 스킬 종류 | ★1~2는 1개, ★3~4는 2개, ★5는 3개 |
| 편성 (4명 선택) | 전투 참여 영웅 결정 | 전열 2 + 후열 2 배치, 역할 조합이 전략 |
| 편성 포지션 (전열/후열) | 피격 우선도, 스킬 대상 | 전열은 피격 우선, 후열은 보호받음 |

### 코어 → 메타 (전투가 메타 시스템에 주는 데이터)

| 코어 이벤트 | 메타로 전달하는 데이터 | 처리 |
|-----------|---------------------|------|
| 스테이지 승리 | 골드, 소울스톤, EXP | 즉시 재화 지급, EXP는 편성 영웅에 분배 |
| 스테이지 패배 (전멸) | 진행 스테이지 수, 누적 보상 | 현재까지 획득한 보상 정산 후 메인 복귀 |
| 챕터 클리어 (보스 승리) | 챕터 클리어 플래그, 보너스 보상 | 최초 클리어 보너스 지급, 클리어 기록 저장 |
| 로그라이트 스킬 선택 | 선택된 스킬 정보 | 런 내에서만 유효, 메타에 영구 영향 없음 |

### 전투력 계산 공식 (편성 화면 표시용)
```
영웅 전투력 = (기본ATK + 기본HP/10 + 기본DEF) × 등급배율 × (1 + 0.05 × (레벨-1))
파티 전투력 = 4명 영웅 전투력 합산
```
- 편성 화면에서 "추천 전투력" 대비 내 파티 전투력을 보여주어 난이도 가늠 가능
- 챕터 1 추천 전투력: **400** (★2 Lv.1 영웅 4명 기준 약 360, 약간의 성장 필요 시사)

---

## 개발자 전달 사항

### 구현 우선순위

| 우선순위 | 기능 | 설명 | 필수 여부 |
|---------|------|------|----------|
| P0 | 재화 시스템 (골드, 소울스톤) | 획득/소비/잔액 표시. localStorage에 저장 | 필수 |
| P0 | 영웅 데이터 구조 | 6종 영웅의 등급/스탯/스킬/레벨 정보 | 필수 |
| P0 | 영웅 뽑기 (가챠) | 소울스톤 소비 → 확률 기반 영웅 획득 → 영웅 목록 추가 | 필수 |
| P0 | 영웅 편성 | 보유 영웅 중 4명 선택 + 전열/후열 배치 | 필수 |
| P0 | 스테이지 보상 지급 | 전투 승리 시 골드/소울스톤/EXP 지급 | 필수 |
| P1 | 영웅 레벨업 | 골드 소비 → EXP 확인 → 레벨 상승 → 스탯 반영 | 높음 |
| P1 | 10연차 뽑기 | 할인 + ★3 보장 로직 | 높음 |
| P1 | 챕터 클리어 보상 | 최초 클리어 여부 체크 + 보너스 지급 | 높음 |
| P2 | 중복 영웅 → 영혼 파편 | 이미 보유 시 파편 전환 | 선택 |
| P2 | 영혼 파편 → 소울스톤 교환 | 교환 UI + 로직 | 선택 |
| P2 | 미보유 영웅 실루엣 | 영웅 목록에서 미수집 영웅 표시 | 선택 |

### 데이터 저장 구조 (localStorage)
```typescript
interface GameSaveData {
  // 재화
  gold: number;
  soulStones: number;
  soulFragments: number;

  // 영웅
  heroes: {
    id: string;
    level: number;
    exp: number;
    owned: boolean;
  }[];

  // 편성
  party: {
    frontLine: [string | null, string | null];  // 영웅 ID 2명
    backLine: [string | null, string | null];    // 영웅 ID 2명
  };

  // 진행
  chapter1Cleared: boolean;
  totalRuns: number;
}
```

### 초기 상태
```typescript
const INITIAL_SAVE: GameSaveData = {
  gold: 0,
  soulStones: 300,       // 첫 단일 뽑기 1회 체험용
  soulFragments: 0,
  heroes: [
    { id: 'ironclad', level: 1, exp: 0, owned: true },   // ★2 탱커 초기 지급
    { id: 'lumina', level: 1, exp: 0, owned: true },     // ★2 힐러 초기 지급
    { id: 'blade', level: 1, exp: 0, owned: false },
    { id: 'silvana', level: 1, exp: 0, owned: false },
    { id: 'ignis', level: 1, exp: 0, owned: false },
    { id: 'shadow', level: 1, exp: 0, owned: false },
  ],
  party: {
    frontLine: ['ironclad', null],
    backLine: ['lumina', null],
  },
  chapter1Cleared: false,
  totalRuns: 0,
};
```

### 구현 시 주의 사항
1. **뽑기 연출**: 뽑기 결과 화면에서 등급별 컬러 이펙트 차별화 (★4 이상은 화려하게)
2. **재화 부족 안내**: 소울스톤이 뽑기 비용 미만일 때 버튼 비활성화 + "소울스톤 부족" 표시
3. **초기 편성 제한**: 영웅 2명만 있을 때도 던전 입장 가능 (빈 슬롯 허용), 4명 편성 권장 표시
4. **보상 정산 화면**: 던전 종료(성공/실패) 시 획득 재화를 한눈에 보여주는 정산 팝업
5. **로그라이트 스킬은 런 한정**: 스킬 선택은 해당 런에서만 유효, 런 종료 시 초기화 (코어 시스템 영역이지만 혼동 방지를 위해 명시)
